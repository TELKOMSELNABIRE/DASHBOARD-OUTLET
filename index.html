<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Monitoring Outlet</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f4f6f8;
}
header {
  background: #1f2937;
  color: #fff;
  padding: 14px 20px;
  font-size: 18px;
  font-weight: bold;
}
.menu {
  display: flex;
  gap: 10px;
  padding: 12px 20px;
  background: #fff;
}
.menu button {
  padding: 8px 16px;
  border: none;
  border-radius: 6px;
  background: #e5e7eb;
  cursor: pointer;
  font-weight: bold;
}
.menu button.active {
  background: #2563eb;
  color: #fff;
}
.controls {
  display: flex;
  gap: 10px;
  padding: 12px 20px;
}
.controls input, .controls select {
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #ccc;
}
table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
}
th, td {
  padding: 10px;
  border-bottom: 1px solid #eee;
  text-align: left;
}
th {
  background: #f9fafb;
}
.rank {
  font-weight: bold;
  color: #16a34a;
}
@media(max-width:768px){
  table { font-size: 12px; }
}
</style>
</head>

<body>

<header>Dashboard Monitoring Outlet</header>

<div class="menu">
  <button onclick="loadSheet('TRASSER')" class="active" id="btn-TRASSER">TRASSER</button>
  <button onclick="loadSheet('TRAGIS')" id="btn-TRAGIS">TRAGIS</button>
  <button onclick="loadSheet('TRAVO')" id="btn-TRAVO">TRAVO</button>
</div>

<div class="controls">
  <input type="text" id="search" placeholder="Search Outlet ID / Nama">
  <select id="sort">
    <option value="rank-asc">Rank ↑</option>
    <option value="rank-desc">Rank ↓</option>
    <option value="score-asc">Score ↑</option>
    <option value="score-desc">Score ↓</option>
  </select>
</div>

<table>
  <thead>
    <tr>
      <th>Rank</th>
      <th>Outlet ID</th>
      <th>Nama Outlet</th>
      <th>Rev Jan'25</th>
      <th>Rev Jan'26</th>
      <th>YoY</th>
      <th>Score</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>

<script>
const SHEET_ID = "175sV8aSZaZK3QUAvy4vVfE6J7DTiO8SNfeVd_qYXbqw";
let allData = [];

fetch(SHEET_URL)
  .then(res => res.text())
  .then(csv => {
    const rows = csv.split("\n").slice(1);

    allData = rows.map(r => {
      const c = r.split(",");

      return {
        outletId: c[0],
        outletName: c[2],
        rev25: Number(c[4]) || 0,
        rev26: Number(c[6]) || 0,
        yoy: c[7],
        eligible: c[9],
        score: Number(c[10]) || 0,
        rank: Number(c[11]) || 0
      };
    });

    render(allData);
  });

function render(data) {
  const list = document.getElementById("list");
  list.innerHTML = "";

  data.forEach(d => {
    list.innerHTML += `
      <div class="card">
        <b>${d.outletName}</b><br>
        <small>ID: ${d.outletId}</small><br>
        <small>Rank: ${d.rank} | Score: ${d.score}</small>
        <hr>
        <div>Rev Jan’25: Rp ${d.rev25.toLocaleString()}</div>
        <div>Rev Jan’26: Rp ${d.rev26.toLocaleString()}</div>
        <div>YoY: ${d.yoy}</div>
        <div>Eligible: ${d.eligible}</div>
      </div>
    `;
  });
}

/* SEARCH OUTLET */
document.getElementById("search").addEventListener("input", e => {
  const v = e.target.value.toLowerCase();
  render(allData.filter(d =>
    d.outletName.toLowerCase().includes(v) ||
    d.outletId.includes(v)
  ));
});

/* SORT */
function sortBy(type) {
  let sorted = [...allData];
  if (type === "rank") sorted.sort((a,b) => a.rank - b.rank);
  if (type === "score") sorted.sort((a,b) => b.score - a.score);
  render(sorted);
}
</script>

</body>
</html>
