<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Outlet</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Poppins', sans-serif;
  background: #f4f6f8;
  margin: 0;
}

header {
  background: #b51217;
  color: #fff;
  padding: 16px;
  text-align: center;
}

nav {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin: 20px;
}

nav button {
  padding: 10px 18px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  background: #e0e0e0;
}

nav button.active {
  background: #b51217;
  color: #fff;
}

.container {
  max-width: 1200px;
  margin: auto;
  padding: 20px;
}

.search-sort {
  display: flex;
  gap: 10px;
  margin-bottom: 14px;
}

.search-sort input,
.search-sort select {
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
}

th, td {
  padding: 12px;
  border-bottom: 1px solid #eee;
  text-align: left;
}

th {
  background: #f0f0f0;
}
</style>
</head>

<body>

<header>
  <h2>Dashboard Outlet</h2>
</header>

<nav>
  <button class="active" onclick="loadSheet('TRASSER', this)">TRASSER</button>
  <button onclick="loadSheet('TRAGIS', this)">TRAGIS</button>
  <button onclick="loadSheet('TRAVO', this)">TRAVO</button>
</nav>

<div class="container">

<div class="search-sort">
  <input type="text" id="search" placeholder="Search Outlet...">
  <select id="sort">
    <option value="">Sort</option>
    <option value="rank">Rank</option>
    <option value="score">Score</option>
  </select>
</div>

<table>
<thead>
<tr>
  <th>Outlet ID</th>
  <th>Nama Outlet</th>
  <th>Rev Jan'25</th>
  <th>Rev Jan'26</th>
  <th>YoY</th>
  <th>Eligible</th>
  <th>Score</th>
  <th>Rank</th>
</tr>
</thead>
<tbody id="data"></tbody>
</table>

</div>

<script>
const SHEET_ID =
"2PACX-1vSU1jMmoHiOKZ4imo91F5h9XdcykRG3CbqEQNthOXeVIOh1vsb51khLRXUdJBBfIKKgD3SKb-o2IDHQ";

let rawData = [];

function loadSheet(sheet, btn) {
  document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");

  const url = `https://docs.google.com/spreadsheets/d/e/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${sheet}`;

  fetch(url)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.replace(/.*?\(/, '').slice(0, -2));
      const rows = json.table.rows;

      rawData = rows.map(r => ({
        id: r.c[0]?.v ?? "",
        nama: r.c[2]?.v ?? "",
        rev25: r.c[4]?.f ?? "",
        rev26: r.c[6]?.f ?? "",
        yoy: r.c[7]?.f ?? "",
        eligible: r.c[9]?.v ?? "",
        score: Number(r.c[10]?.v ?? 0),
        rank: Number(r.c[11]?.v ?? 0)
      }));

      render(rawData);
    })
    .catch(err => {
      console.error("ERROR FETCH:", err);
    });
}

function render(data) {
  const tbody = document.getElementById("data");
  tbody.innerHTML = "";

  data.forEach(d => {
    tbody.innerHTML += `
      <tr>
        <td>${d.id}</td>
        <td>${d.nama}</td>
        <td>${d.rev25}</td>
        <td>${d.rev26}</td>
        <td>${d.yoy}</td>
        <td>${d.eligible}</td>
        <td>${d.score}</td>
        <td>${d.rank}</td>
      </tr>
    `;
  });
}

document.getElementById("search").addEventListener("input", e => {
  const q = e.target.value.toLowerCase();
  render(rawData.filter(d => d.nama.toLowerCase().includes(q)));
});

document.getElementById("sort").addEventListener("change", e => {
  if (e.target.value === "rank") {
    render([...rawData].sort((a,b)=>a.rank-b.rank));
  }
  if (e.target.value === "score") {
    render([...rawData].sort((a,b)=>b.score-a.score));
  }
});

loadSheet("TRASSER", document.querySelector("nav button"));
</script>

</body>
</html>
